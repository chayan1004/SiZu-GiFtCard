[Docs Home](https://developer.squareup.com/docs)

[Dev Essentials](https://developer.squareup.com/docs/development-essentials)

[Payments](https://developer.squareup.com/docs/payments-overview) [Commerce](https://developer.squareup.com/docs/commerce) [Customers](https://developer.squareup.com/docs/customers) [Staff](https://developer.squareup.com/docs/staff) [Merchants](https://developer.squareup.com/docs/merchant-details)

[Publish](https://developer.squareup.com/docs/app-marketplace)

[Release notes](https://developer.squareup.com/docs/release-notes)

## Docs

[Docs Home](https://developer.squareup.com/docs)

[Dev Essentials](https://developer.squareup.com/docs/development-essentials)

[Payments](https://developer.squareup.com/docs/payments-overview)

[Commerce](https://developer.squareup.com/docs/commerce)

[Customers](https://developer.squareup.com/docs/customers)

[Staff](https://developer.squareup.com/docs/staff)

[Merchants](https://developer.squareup.com/docs/merchant-details)

[Publish](https://developer.squareup.com/docs/app-marketplace)

[Release notes](https://developer.squareup.com/docs/release-notes)

[Overview](https://developer.squareup.com/docs/payments-overview)

[Technical Scenarios](https://developer.squareup.com/docs/payments/scenarios)

[Build a Tip Report](https://developer.squareup.com/docs/payments/scenarios/tip-reporting)

[Split an Online Payment](https://developer.squareup.com/docs/payments/scenarios/split-online-payment)

[Build a Sales Report](https://developer.squareup.com/docs/payments/scenarios/simple-sales-report)

[Payments](https://developer.squareup.com/docs/payments-refunds)

[Take Payments](https://developer.squareup.com/docs/payments-api/take-payments)

[Card Payments](https://developer.squareup.com/docs/payments-api/take-payments/card-payments)

[Delayed Capture](https://developer.squareup.com/docs/payments-api/take-payments/card-payments/delayed-capture)

[Partial Payments](https://developer.squareup.com/docs/payments-api/take-payments/card-payments/partial-payments-with-gift-cards)

[Statement Descriptions](https://developer.squareup.com/docs/payments-api/take-payments/card-payments/statement-descriptions)

[ACH Bank Transfer Payment](https://developer.squareup.com/docs/payments-api/take-payments/ach-payments)

[Afterpay and Clearpay Payments](https://developer.squareup.com/docs/payments-api/take-payments/afterpay-payments)

[Cash App Payments](https://developer.squareup.com/docs/payments-api/take-payments/cash-app-payments)

[Cash Payments](https://developer.squareup.com/docs/payments-api/take-payments/cash-payments)

[External Payments](https://developer.squareup.com/docs/payments-api/take-payments/external-payments)

[House Accounts](https://developer.squareup.com/docs/payments-api/take-payments/house-accounts)

[Collect Application Fees](https://developer.squareup.com/docs/payments-api/take-payments-and-collect-fees)

[Update Payment and Tip Amounts](https://developer.squareup.com/docs/payments-api/update-payments)

[Retrieve Payments](https://developer.squareup.com/docs/payments-api/retrieve-payments)

[Troubleshoot](https://developer.squareup.com/docs/payments-api/error-codes)

[Webhooks](https://developer.squareup.com/docs/payments-api/webhooks)

[Refunds](https://developer.squareup.com/docs/refunds-api/overview)

[Refund Payments](https://developer.squareup.com/docs/payments-api/refund-payments)

[Refund a Payment with an App Fee](https://developer.squareup.com/docs/payments-api/collect-fees/payment-with-app-fee-refund)

[Retrieve Refunds](https://developer.squareup.com/docs/refunds-api/retrieve-refunds)

[Process an Unlinked Refund](https://developer.squareup.com/docs/refunds-api/unlinked-refunds)

[Webhooks](https://developer.squareup.com/docs/refunds-api/webhooks)

[Disputes](https://developer.squareup.com/docs/disputes-api/overview)

[Process Disputes](https://developer.squareup.com/docs/disputes-api/process-disputes)

[Test in the Sandbox](https://developer.squareup.com/docs/disputes-api/sandbox-testing)

[Take Payments on Hardware](https://developer.squareup.com/docs/in-person-payment-options)

[Terminal API](https://developer.squareup.com/docs/terminal-api/overview)

[Quickstart](https://developer.squareup.com/docs/terminal-api/quickstart)

[Take Payments for Orders](https://developer.squareup.com/docs/terminal-api/take-payments-for-orders)

[Take One-Off Payments](https://developer.squareup.com/docs/terminal-api/square-terminal-payments)

Manage Terminals

[POS App Pairing](https://developer.squareup.com/docs/terminal-api/pos-integration)

[Monitor Square Terminals](https://developer.squareup.com/docs/terminal-api/terminal-device-monitoring)

[Check Device Information](https://developer.squareup.com/docs/terminal-api/advanced-features/check-device-information)

Customize Terminal Checkouts

[Add Payment and Checkout Features](https://developer.squareup.com/docs/terminal-api/additional-payment-checkout-features)

[Save Card on File](https://developer.squareup.com/docs/terminal-api/advanced-features/save-card-on-file)

[Print or Issue Receipts](https://developer.squareup.com/docs/terminal-api/advanced-features/issue-receipts)

[Customize the Idle Screen](https://developer.squareup.com/docs/terminal-api/advanced-features/customize-idle-screen)

[Custom Screen Workflows](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows)

[Confirmation Screen](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows/confirmation)

[Signature Capture Screen](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows/signature)

[Data Collection Screen](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows/data-collection)

[Menu Selection List Screen](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows/menu-select)

[QR Code Screen](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows/qr-code-display)

[Link and Dismiss Actions](https://developer.squareup.com/docs/terminal-api/advanced-features/custom-workflows/link-and-dismiss-actions)

[Manage Terminal Actions](https://developer.squareup.com/docs/terminal-api/advanced-features)

[Mobile Payments SDK](https://developer.squareup.com/docs/mobile-payments-sdk)

[Build on Android](https://developer.squareup.com/docs/mobile-payments-sdk/android)

[Authorize the Mobile Payments SDK](https://developer.squareup.com/docs/mobile-payments-sdk/android/configure-authorize)

[Pair and Manage Card Readers](https://developer.squareup.com/docs/mobile-payments-sdk/android/pair-manage-readers)

[Take a Payment](https://developer.squareup.com/docs/mobile-payments-sdk/android/take-payments)

[Tap to Pay on Android](https://developer.squareup.com/docs/mobile-payments-sdk/android/tap-to-pay)

[Offline Payments](https://developer.squareup.com/docs/mobile-payments-sdk/android/offline-payments)

[Handling Errors](https://developer.squareup.com/docs/mobile-payments-sdk/android/handling-errors)

[Build on iOS](https://developer.squareup.com/docs/mobile-payments-sdk/ios)

[Authorize the Mobile Payments SDK](https://developer.squareup.com/docs/mobile-payments-sdk/ios/configure-authorize)

[Pair and Manage Card Readers](https://developer.squareup.com/docs/mobile-payments-sdk/ios/pair-manage-readers)

[Take a Payment](https://developer.squareup.com/docs/mobile-payments-sdk/ios/take-payments)

[Tap to Pay on iPhone](https://developer.squareup.com/docs/mobile-payments-sdk/ios/tap-to-pay)

[Offline Payments](https://developer.squareup.com/docs/mobile-payments-sdk/ios/offline-payments)

[Configure for Square Stand or Square Kiosk](https://developer.squareup.com/docs/mobile-payments-sdk/ios/square-stand)

[Handling Errors](https://developer.squareup.com/docs/mobile-payments-sdk/ios/handling-errors)

[Migrate from Reader SDK](https://developer.squareup.com/docs/mobile-payments-sdk/migrate)

[React Native Plugin](https://developer.squareup.com/docs/mobile-payments-sdk/react-native)

[Flutter Plugin](https://developer.squareup.com/docs/mobile-payments-sdk/flutter)

[Reader SDK](https://developer.squareup.com/docs/reader-sdk/what-it-does)

[Migrate to Mobile Payments SDK](https://developer.squareup.com/docs/mobile-payments-sdk/migrate)

[Quickstart](https://developer.squareup.com/docs/reader-sdk/quick-start/start)

[Get Credentials](https://developer.squareup.com/docs/reader-sdk/quick-start/step-1)

[Configure the Sample Application](https://developer.squareup.com/docs/reader-sdk/quick-start/step-2)

[Take a Cash Payment](https://developer.squareup.com/docs/reader-sdk/quick-start/step-3)

[Customize the Checkout Amount](https://developer.squareup.com/docs/reader-sdk/quick-start/step-4)

[Take a Credit Card Payment](https://developer.squareup.com/docs/reader-sdk/quick-start/step-5)

[How It Works](https://developer.squareup.com/docs/reader-sdk/how-it-works)

[Build on Android](https://developer.squareup.com/docs/reader-sdk/build-on-android)

[Build on iOS](https://developer.squareup.com/docs/reader-sdk/build-on-ios)

[Connect a Contactless Reader](https://developer.squareup.com/docs/reader-sdk/cookbook/contactless-reader)

[Charge a Card on File](https://developer.squareup.com/docs/reader-sdk/cookbook/charge-cards-on-file)

[Save a Card on File](https://developer.squareup.com/docs/reader-sdk/cookbook/save-cards-on-file)

[Configure on iOS for Square Stand](https://developer.squareup.com/docs/reader-sdk/cookbook/square-stand)

[Deauthorize Reader SDK](https://developer.squareup.com/docs/reader-sdk/cookbook/deauthorize-reader-sdk)

[Capture a Transaction](https://developer.squareup.com/docs/reader-sdk/cookbook/capture-a-transaction)

[Delay the Capture of Payments](https://developer.squareup.com/docs/reader-sdk/cookbook/delay-capture-of-payment)

[Configure APK Splits](https://developer.squareup.com/docs/reader-sdk/cookbook/configure-apk-splits)

[Update to New Reader SDK Version](https://developer.squareup.com/docs/reader-sdk/upgrade-reader-sdk)

[Flutter Plugin](https://developer.squareup.com/docs/reader-sdk/flutter)

[React Native Plugin](https://developer.squareup.com/docs/reader-sdk/react-native)

[Point of Sale API](https://developer.squareup.com/docs/pos-api/what-it-does)

[How It Works](https://developer.squareup.com/docs/pos-api/how-it-works)

[Build on Android](https://developer.squareup.com/docs/pos-api/build-on-android)

[Build on iOS](https://developer.squareup.com/docs/pos-api/build-on-ios)

[Build on Mobile Web](https://developer.squareup.com/docs/pos-api/build-mobile-web)

[Find Your Android Fingerprint](https://developer.squareup.com/docs/pos-api/cookbook/find-your-android-fingerprint)

[Use the API in Offline Mode](https://developer.squareup.com/docs/pos-api/cookbook/offline-mode)

[Add an Alert Dialog Helper Class](https://developer.squareup.com/docs/pos-api/cookbook/alert-dialog-helper)

[Accept E-Money Payments](https://developer.squareup.com/docs/pos-api/cookbook/electronic-payments)

[Accept PayPay Payments](https://developer.squareup.com/docs/pos-api/qr-code-payments-paypay)

[Mobile Web Technical Reference](https://developer.squareup.com/docs/pos-api/web-technical-reference)

[Payments API Integration](https://developer.squareup.com/docs/pos-api/payments-integration)

[Take Payments Online](https://developer.squareup.com/docs/online-payment-options)

[Web Payments SDK](https://developer.squareup.com/docs/web-payments/overview)

[Quickstart](https://developer.squareup.com/docs/web-payments/quickstart)

[Set Up the Web Client App](https://developer.squareup.com/docs/web-payments/quickstart/set-up-web-client-app)

[Add the SDK to the Web Client](https://developer.squareup.com/docs/web-payments/quickstart/add-sdk-to-web-client)

[Deploy the Application](https://developer.squareup.com/docs/web-payments/quickstart/deploy-app)

[Take a Card Payment](https://developer.squareup.com/docs/web-payments/take-card-payment)

[Integrate Digital Wallets](https://developer.squareup.com/docs/web-payments/digital-wallets)

[Apple Pay](https://developer.squareup.com/docs/web-payments/apple-pay)

[Google Pay](https://developer.squareup.com/docs/web-payments/google-pay)

[Digital Wallet Payment Requests](https://developer.squareup.com/docs/web-payments/payment-requests)

[ACH Bank Transfer](https://developer.squareup.com/docs/web-payments/add-ach)

[Afterpay](https://developer.squareup.com/docs/web-payments/add-afterpay)

[Cash App Pay](https://developer.squareup.com/docs/web-payments/add-cash-app-pay)

[Square Gift Card Payments](https://developer.squareup.com/docs/web-payments/gift-cards-intro)

[Take a Gift Card Payment](https://developer.squareup.com/docs/web-payments/gift-card)

[Take Partial Payments](https://developer.squareup.com/docs/web-payments/gift-card-walkthrough)

[Customize the Card Entry Form](https://developer.squareup.com/docs/web-payments/customize-styles)

[Charge and Store Cards](https://developer.squareup.com/docs/web-payments/charge-and-store-cards)

[Add a Content Security Policy](https://developer.squareup.com/docs/web-payments/content-security-policy)

[In-App Payments SDK](https://developer.squareup.com/docs/in-app-payments-sdk/what-it-does)

[Quickstart](https://developer.squareup.com/docs/in-app-payments-sdk/quick-start)

[Set up the Client](https://developer.squareup.com/docs/in-app-payments-sdk/quick-start/generate-token)

[Deploy the Server](https://developer.squareup.com/docs/in-app-payments-sdk/quick-start/deploy-server-backend)

[Install the SDK](https://developer.squareup.com/docs/in-app-payments-sdk/installation)

[Build on Android](https://developer.squareup.com/docs/in-app-payments-sdk/build-on-android)

[Build on iOS](https://developer.squareup.com/docs/in-app-payments-sdk/build-on-ios)

[Integrate Digital Wallets](https://developer.squareup.com/docs/in-app-payments-sdk/add-digital-wallets)

[Google Pay](https://developer.squareup.com/docs/in-app-payments-sdk/add-digital-wallets/google-pay)

[Apple Pay](https://developer.squareup.com/docs/in-app-payments-sdk/add-digital-wallets/apple-pay)

[Localize an Application](https://developer.squareup.com/docs/in-app-payments/localize-ios)

[Gift Card Payments](https://developer.squareup.com/docs/in-app-payments-sdk/cookbook/giftcards)

[Flutter Plugin](https://developer.squareup.com/docs/in-app-payments-sdk/flutter)

[React Native Plugin](https://developer.squareup.com/docs/in-app-payments-sdk/react-native)

[Customize the Payment Entry Form](https://developer.squareup.com/docs/in-app-payments-sdk/cookbook/customize-payment-form)

[Connect to a Backend Service](https://developer.squareup.com/docs/in-app-payments-sdk/cookbook/connect-to-a-backend-service)

[Remove the Postal Code Requirement](https://developer.squareup.com/docs/in-app-payments-sdk/cookbook/disable-postal-code)

[Troubleshoot](https://developer.squareup.com/docs/in-app-payments-sdk/troubleshooting)

[How It Works](https://developer.squareup.com/docs/in-app-payments-sdk/how-it-works)

[Strong Customer Authentication](https://developer.squareup.com/docs/sca-overview-iap)

[Verify a Buyer](https://developer.squareup.com/docs/in-app-payments-sdk/verify-buyer)

[Checkout API](https://developer.squareup.com/docs/checkout-api)

[Quick Pay Checkout](https://developer.squareup.com/docs/checkout-api/quick-pay-checkout)

[Square Order Checkout](https://developer.squareup.com/docs/checkout-api/square-order-checkout)

[Subscription Plan Checkout](https://developer.squareup.com/docs/checkout-api/subscription-plan-checkout)

[Checkout Settings](https://developer.squareup.com/docs/checkout-api/checkout-settings)

[Checkout Configurations](https://developer.squareup.com/docs/checkout-api/optional-checkout-configurations)

[Manage Checkout](https://developer.squareup.com/docs/checkout-api/manage-checkout)

[Guidelines and Limitations](https://developer.squareup.com/docs/checkout-api/guidelines-and-limitations)

[Subscriptions API](https://developer.squareup.com/docs/subscriptions/overview)

[Subscription Plans and Variations](https://developer.squareup.com/docs/subscriptions-api/plans-and-variations)

[Manage Subscriptions](https://developer.squareup.com/docs/subscriptions-api/manage-subscriptions)

[Subscription Actions and Events](https://developer.squareup.com/docs/subscriptions-api/actions-events)

[Pause, Resume, or Cancel Subscriptions](https://developer.squareup.com/docs/subscriptions-api/pause-resume-cancel-subscriptions)

[Subscription Billing and Invoices](https://developer.squareup.com/docs/subscriptions-api/subscription-billing)

[Swap Subscription Plan Variations](https://developer.squareup.com/docs/subscriptions-api/swap-plan-variations)

[Invoices API](https://developer.squareup.com/docs/invoices-api/overview)

[Create and Publish Invoices](https://developer.squareup.com/docs/invoices-api/create-publish-invoices)

[Retrieve, List, or Search Invoices](https://developer.squareup.com/docs/invoices-api/retrieve-list-search-invoices)

[Create or Delete Invoice Attachments](https://developer.squareup.com/docs/invoices-api/attachments)

[Update Invoices](https://developer.squareup.com/docs/invoices-api/update-invoices)

[Cancel or Delete Invoices](https://developer.squareup.com/docs/invoices-api/cancel-delete-invoices)

[Pay or Refund Invoices](https://developer.squareup.com/docs/invoices-api/pay-refund-invoices)

[Walkthrough: Create and Publish Invoices](https://developer.squareup.com/docs/invoices-api/walkthrough)

[Cards](https://developer.squareup.com/docs/cards-api/overview)

[Manage Cards](https://developer.squareup.com/docs/cards-api/manage-cards)

[Create a Card on File from Payment ID](https://developer.squareup.com/docs/cards-api/walkthrough/card-from-payment-id)

[Create a Card on File and Make a Payment](https://developer.squareup.com/docs/cards-api/walkthrough-seller-card)

[Create a Shared Card on File and Make a Payment](https://developer.squareup.com/docs/cards-api/walkthrough-shared-card)

[Manage Card Declines](https://developer.squareup.com/docs/cards-api/manage-card-on-file-declines)

[Payouts](https://developer.squareup.com/docs/payouts-api/overview)

[List Payouts](https://developer.squareup.com/docs/payouts-api/list-payouts)

[Get Payout](https://developer.squareup.com/docs/payouts-api/get-payout)

[List Payout Entries](https://developer.squareup.com/docs/payouts-api/list-payout-entries)

[Bank Accounts](https://developer.squareup.com/docs/bank-accounts-api)

[Mobile Authorization](https://developer.squareup.com/docs/mobile-authz/what-it-does)

[How It Works](https://developer.squareup.com/docs/mobile-authz/how-it-works)

[Build with Mobile Authorization](https://developer.squareup.com/docs/mobile-authz/build-with-mobile-authz)

[Get Authorization Code on Command Line](https://developer.squareup.com/docs/mobile-authz/cookbook/mobile-code-with-curl)

[Payment Methods by Country](https://developer.squareup.com/docs/payment-card-support-by-country)

[Payments Pricing](https://developer.squareup.com/docs/payments-pricing)

[Strong Customer Authentication](https://developer.squareup.com/docs/sca-overview)

[Payment Minimums](https://developer.squareup.com/docs/payment-minimums)

[Documentation homepage](https://developer.squareup.com/docs)

/

[Payments](https://developer.squareup.com/docs/payments-overview)

/

[Take Payments Online](https://developer.squareup.com/docs/online-payment-options)

/

[Web Payments SDK](https://developer.squareup.com/docs/web-payments/overview)

# Charge and Store Cards for Online Payments

**Applies to:** [Web Payments SDK](https://developer.squareup.com/docs/web-payments/overview) \| [Payments API](https://developer.squareup.com/docs/payments-refunds) \| [Cards API](https://developer.squareup.com/docs/cards-api/overview) \| [Customers API](https://developer.squareup.com/docs/customers-api/what-it-does)

Learn how to use the Web Payments SDK to charge a card and store card details for future online payments with a card on file.

[anchor link for overview](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#overview)

Link to section

## Overview

After configuring your application with the Web Payments SDK to accept card-not-present payments, you can use the Web Payments SDK to store card details with Square as a card on file and charge the card on file for future online payments.

[anchor link for how-the-card-on-file-workflows-work](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#how-the-card-on-file-workflows-work)

Link to section

## How the card-on-file workflows work

During payment tokenization, Square checks the tokenize request to determine whether [buyer verification](https://developer.squareup.com/docs/sca-overview) is needed based on the buyer's information. After receiving the payment token and verifying the buyer, the application performs one of the following card-on-file workflows:

- **Store card details** \- The application includes the payment token in a Cards API call to store card details as a card on file with [CreateCard](https://developer.squareup.com/reference/square/cards-api/create-card).

- **Charge a card on file** \- The application includes the payment token in a Payments API call to process a payment with [CreatePayment](https://developer.squareup.com/reference/square/payments-api/create-payment).

- **Charge a card and store card details** \- The application charges the card and stores the card details as a card on file with a single request call. The application includes the payment token in a Payments API call to process a payment and then creates a card on file and stores the card details as a `Card` object with a new customer profile. When you call `CreateCard`, the `source_id` is the `payment_id` from the Payments API payment response object. This workflow is ideal for scenarios where buyers want to save their card details while making a payment.


To explore example implementations of the card-on-file workflows, see [Web Payments SDK Quickstart](https://developer.squareup.com/docs/web-payments/quickstart) or set up the [quickstart repository](https://github.com/square/web-payments-quickstart) and choose from the available examples.

The following are additional code examples of each card-on-file workflow setup:

- [Store card details](https://github.com/square/web-payments-quickstart/blob/273eb48c41ce189683e12d8628c7e81c8509854f/public/examples/card-store.html)
- [Charge a card on file](https://github.com/square/web-payments-quickstart/blob/273eb48c41ce189683e12d8628c7e81c8509854f/public/examples/card-charge-card-on-file.html)
- [Charge a card and store its details](https://github.com/square/web-payments-quickstart/blob/273eb48c41ce189683e12d8628c7e81c8509854f/public/examples/card-charge-and-store.html)

[anchor link for set-up-a-card-on-file-workflow](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#set-up-a-card-on-file-workflow)

Link to section

## Set up a card-on-file workflow

[anchor link for requirements-and-limitations](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#requirements-and-limitations)

Link to section

### Requirements and limitations

Update your application to support the Web Payments SDK card payment flow by following the instructions in [Take a Card Payment](https://developer.squareup.com/docs/web-payments/take-card-payment) or [Add the Web Payments SDK to the Web Client](https://developer.squareup.com/docs/web-payments/quickstart/add-sdk-to-web-client).

Choose a workflow when you set up the application. Follow the example code by setting up the [quickstart repository](https://github.com/square/web-payments-quickstart).

The "store card details" workflow involves a `storeCard` method to store card details, while the "charge a card on file" workflow modifies a `CreatePayment` method to take the payment token and the customer ID. If your application needs to charge a card for a payment and store the card details from that same payment, use the "charge a card and store its details" workflow where the application combines both tasks in a single request call.

[anchor link for store-card-details](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#store-card-details)

Link to section

### Store card details

1. Add a helper `storeCard` method, as shown in the following example, that passes the `token` and `customerId` objects as arguments to your server. The server can then make the call to the Square [CreateCard](https://developer.squareup.com/reference/square/cards-api/create-card) endpoint.

















Copy







Expand











```

async function storeCard(token, customerId) {
     const body = JSON.stringify({
       locationId,
       sourceId: token,
       customerId,
       idempotencyKey: window.crypto.randomUUID(),
     });

     const paymentResponse = await fetch('/card', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json',
       },
       body,
     });

     if (paymentResponse.ok) {
       return paymentResponse.json();
     }

     const errorBody = await paymentResponse.text();
     throw new Error(errorBody);
}
```

2. Modify the `tokenize` method with the following updates to `verificationDetails`. Set `intent` to `STORE`, `customerInitiated` to `true`, and `sellerKeyedIn` to `false`.

















Copy







Expand











```

async function tokenize(paymentMethod) {
     const verificationDetails = {
       billingContact: {
         givenName: 'John',
         familyName: 'Doe',
         email: 'john.doe@square.example',
         phone: '3214563987',
         addressLines: ['123 Main Street', 'Apartment 1'],
         city: 'London',
         state: 'LND',
         countryCode: 'GB',
       },
       intent: 'STORE',
       customerInitiated: true,
       sellerKeyedIn: false,
        };

     const tokenResult = await paymentMethod.tokenize(verificationDetails);

     if (tokenResult.status === 'OK') {
       return tokenResult.token;
     } else {
       throw new Error(
         `Tokenization errors: ${JSON.stringify(tokenResult.errors)}`,
       );
     }
}
```

3. Replace the `handlePaymentMethodSubmission` method with a new method called `handleStoreCardSubmission`, pass the `event`, `card`, and `customerId` arguments to the method, and modify the following `try` statement declaration from the code example:

















Copy







Expand











```

async function handleStoreCardSubmission(event, card, customerId) {
     event.preventDefault();

     try {
       // disable the submit button as we await tokenization and make a payment request.
       cardButton.disabled = true;
       const token = await tokenize(card);
       const storeCardResults = await storeCard(
         token,
         customerId,
       );

       displayResults('SUCCESS');
       console.debug('Store Card Success', storeCardResults);
     } catch (e) {
       cardButton.disabled = false;
       displayResults('FAILURE');
       console.error('Store Card Failure', e);
     }
}
```

4. In the `cardButton.addEventListener` event listener, declare a new `customerId` object and call the `handleStoreCardSubmission` method as indicated in the following code example:

















Copy







Expand











```

const cardButton = document.getElementById('card-button');

cardButton.addEventListener('click', async function (event) {
     const textInput = document.getElementById('customer-input');
     if (!textInput.reportValidity()) {
       return;
     }

     const customerId = textInput.value;

     handleStoreCardSubmission(event, card, customerId);
});
```


[anchor link for charge-a-card-on-file](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#charge-a-card-on-file)

Link to section

### Charge a card on file

1. In your application, initialize a [Card](https://developer.squareup.com/reference/sdks/web/payments/objects/Card) object.

2. Call [Card.tokenize()](https://developer.squareup.com/reference/sdks/web/payments/objects/Card#Card.tokenize) with the `verificationDetails` and `cardId` of the stored card.

The `Card.tokenize()` method passes the following properties in a `verificationDetails` object:


   - `amount` \- The amount of the card payment to be charged.
   - `billingContact` \- The buyer's contact information for billing.
   - `intent` \- The transactional intent of the payment.
   - `sellerKeyedIn` \- Indicates that the seller keyed in payment details on behalf of the customer. This is used to flag a payment as Mail Order / Telephone Order (MOTO).
   - `customerInitiated` \- Indicates whether the customer initiated the payment.
   - `currencyCode` \- The three-letter ISO 4217 currency code.

#### Important

Provide as much buyer information as possible for `billingContact` so that you get more accurate decline rate performance from 3DS authentication.

3. Modify the [CreatePayment](https://developer.squareup.com/reference/square/payments-api/create-payment) endpoint by renaming the `createPaymentWithCardOnFile` function and passing in the `token` and `customerId`.

The following code example demonstrates the charge card-on-file setup.

















Copy







Expand











```


async function createPaymentWithCardOnFile(
        token,
        customerId,
      ) {
        const body = JSON.stringify({
          locationId,
          sourceId: token,
          customerId,
          idempotencyKey: window.crypto.randomUUID(),
        });

        const paymentResponse = await fetch('/payment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body,
        });

        if (paymentResponse.ok) {
          return paymentResponse.json();
        }

        const errorBody = await paymentResponse.text();
        throw new Error(errorBody);
      }

      // status is either SUCCESS or FAILURE;
      function displayPaymentResults(status) {
        const statusContainer = document.getElementById(
          'payment-status-container',
        );
        if (status === 'SUCCESS') {
          statusContainer.classList.remove('is-failure');
          statusContainer.classList.add('is-success');
        } else {
          statusContainer.classList.remove('is-success');
          statusContainer.classList.add('is-failure');
        }

        statusContainer.style.visibility = 'visible';
      }

      async function tokenize(paymentMethod, sourceId) {
        const verificationDetails = {
          amount: '1.00',
          billingContact: {
            givenName: 'John',
            familyName: 'Doe',
            email: 'john.doe@square.example',
            phone: '3214563987',
            addressLines: ['123 Main Street', 'Apartment 1'],
            city: 'London',
            state: 'LND',
            countryCode: 'GB',
          },
          currencyCode: 'GBP',
          intent: 'CHARGE',
          customerInitiated: true,
          sellerKeyedIn: false,
        };
        const tokenResult = await paymentMethod.tokenize(verificationDetails, sourceId);
        if (tokenResult.status === 'OK') {
          return tokenResult.token;
        } else {
          let errorMessage = `Tokenization failed with status: ${tokenResult.status}`;
          if (tokenResult.errors) {
            errorMessage += ` and errors: ${JSON.stringify(
                tokenResult.errors,
            )}`;
          }

          throw new Error(errorMessage);
        }
      }

      document.addEventListener('DOMContentLoaded', async function () {
        if (!window.Square) {
          throw new Error('Square.js failed to load properly');
        }

        let payments;
        try {
          payments = window.Square.payments(appId, locationId);
        } catch {
          const statusContainer = document.getElementById(
            'payment-status-container',
          );
          statusContainer.className = 'missing-credentials';
          statusContainer.style.visibility = 'visible';
          return;
        }

        let card;
        try {
          card = await payments.card();
        } catch (e) {
          console.error('Initializing Card failed', e);
          return;
        }

        async function handleChargeCardOnFileSubmission(
          event,
          card,
          cardId,
          customerId,
        ) {
          event.preventDefault();

          try {
            // disable the submit button as we await tokenization and make a payment request.
            cardButton.disabled = true;

            const token = await tokenize(card, cardId);
            const paymentResults = await createPaymentWithCardOnFile(
              token,
              customerId
            );

            displayPaymentResults('SUCCESS');
            console.debug('Payment Success', paymentResults);
          } catch (e) {
            cardButton.disabled = false;
            displayPaymentResults('FAILURE');
            console.error(e.message);
          }
        }

        const cardButton = document.getElementById('card-button');
        cardButton.addEventListener('click', async function (event) {
          const customerTextInput = document.getElementById('customer-input');
          const cardTextInput = document.getElementById('card-input');

          if (
            !customerTextInput.reportValidity() ||
            !cardTextInput.reportValidity()
          ) {
            return;
          }

          const cardId = cardTextInput.value;
          const customerId = customerTextInput.value;
          handleChargeCardOnFileSubmission(event, card, cardId, customerId);
        });
      });
```


[anchor link for charge-a-card-and-store-its-details](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#charge-a-card-and-store-its-details)

Link to section

### Charge a card and store its details

1. After the `CreatePayment` method in your application, create a new method called `storeCard`, pass the `paymentId` and `customerId` objects as arguments, and add the requisite properties and the `storeCardResponse` as shown in the following example:

















Copy







Expand











```

async function storeCard(paymentId, customerId) {
     const body = JSON.stringify({
       locationId,
       sourceId: paymentId,
       customerId,
       idempotencyKey: window.crypto.randomUUID(),
     });

     const storeCardResponse = await fetch('/card', {
       method: 'POST',
       headers: {
         'Content-Type': 'application/json',
       },
       body,
     });
     if (storeCardResponse.ok) {
       return storeCardResponse.json();
     }
     const errorBody = await storeCardResponse.text();
     throw new Error(errorBody);
}
```

2. In the `tokenize` method, update the `verificationDetails` object by setting `intent` to `CHARGE_AND_STORE`.

















Copy







Expand











```

async function tokenize(paymentMethod) {
     const verificationDetails = {
       amount: '1.00',
       billingContact: {
         givenName: 'John',
         familyName: 'Doe',
         email: 'john.doe@square.example',
         phone: '3214563987',
         addressLines: ['123 Main Street', 'Apartment 1'],
         city: 'London',
         state: 'LND',
         countryCode: 'GB',
       },
       currencyCode: 'GBP',
       intent: 'CHARGE_AND_STORE',
       customerInitiated: true,
       sellerKeyedIn: false,
     };
```

3. In the `document.addEventListener` event listener method, change the `handlePaymentMethodSubmission` method to `handleChargeAndStoreCardSubmission`, pass the `event`, `card`, and `customerId` objects as arguments, and modify the rest of the code as shown in the following example:

















Copy







Expand











```

async function handleChargeAndStoreCardSubmission(event, card, customerId) {
     event.preventDefault();

     try {
       // disable the submit button as we await tokenization and make a payment request.
       cardButton.disabled = true;
       const token = await tokenize(card);
       const paymentResults = await createPayment(token);
       console.debug('Payment Success', paymentResults);

       const storeCardResults = await storeCard(
         paymentResults.payment.id,
         customerId,
       );
       console.debug('Store Card Success', storeCardResults);
       displayPaymentResults('SUCCESS');
     } catch (e) {
       cardButton.disabled = false;
       displayPaymentResults('FAILURE');
       console.error(e.message);
     }
}

const cardButton = document.getElementById('card-button');
cardButton.addEventListener('click', async function (event) {
     const textInput = document.getElementById('customer-input');
     if (!textInput.reportValidity()) {
       return;
     }
     const customerId = textInput.value;
     await handleChargeAndStoreCardSubmission(event, card, customerId);
});
```


[anchor link for recommended-next-step](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#recommended-next-step)

Link to section

## Recommended next step

If your application doesn't yet have a Content Security Policy configured, see [Add a Content Security Policy](https://developer.squareup.com/docs/web-payments/content-security-policy).

##### On this page

[Overview](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#overview) [How the card-on-file workflows work](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#how-the-card-on-file-workflows-work) [Set up a card-on-file workflow](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#set-up-a-card-on-file-workflow) [Recommended next step](https://developer.squareup.com/docs/web-payments/charge-and-store-cards#recommended-next-step)

Thanks for the feedback. For more help, check out our support resources.

[Developer Support](https://squareup.com/help/contact?panel=BF53A9C8EF68) [Developer Forums](https://developer.squareup.com/forums)

There was an error submitting feedback. Try again later.

[Developer Support](https://squareup.com/help/contact?panel=BF53A9C8EF68) [Developer Forums](https://developer.squareup.com/forums)

### Was this page helpful?

Yes

No

If you need more assistance, contact [Developer and App Marketplace Support](https://squareup.com/help/contact?panel=BF53A9C8EF68) or ask for help in the [Developer Forums](https://developer.squareup.com/forums).

![Company Logo](https://cdn.cookielaw.org/logos/aa498dad-1691-4c3b-894a-906c990be323/eab8b6ff-57d6-438a-a7e5-c58dd370ce73/000d8b20-8c3d-4f4f-a0da-5b515f8f20d2/Square_combinationmark_black.png)

## Cookie preferences

When you interact with our mobile applications or online services, we and third parties obtain certain information by using automated technologies, such as cookies, web beacons, and other technologies described in our Cookie Policy. This information might be about you, your preferences, or your device. You may opt out of certain categories of third party cookies, other than those that are strictly necessary to provide you with our Services. Expand the different categories for more information and to make your choices.

To effectuate your right to opt-out of the sharing of your personal information for purposes of targeted advertising, please toggle off "retargeting or advertising technology" cookies below.


[More information](https://squareup.com/gb/en/legal/general/cookie) [Privacy Notice](https://squareup.com/us/en/legal/general/privacy)

Accept all cookies

### Manage cookie preferences

#### Strictly necessary technology

Always Active

These technologies are necessary for us to provide you with the Services.

#### Performance and analytical technology

Performance and analytical technology

This information is used to make sure our Services can cope with the volume of users, to help us correct errors in the Services and to measure use across our Services. These technologies help us understand if you have used our Services before so we can identify the number of unique users we receive. They also help us understand how long you spend using our Services and from where you have accessed the Services, so that we can improve the Services and learn about the most popular aspects of the Services.

#### Functionality technology

Functionality technology

These technologies enable us to remember you have used our Services before, preferences you may have indicated, and information you have provided to us to give you a customized experience. For example, this would include ensuring the continuity of your registration process.

#### Retargeting or advertising technology

Retargeting or advertising technology

We use third parties, for example, Google Analytics, to analyze statistical information from users of the Site. We might be able to associate such information with other information which we collect from you once we receive it from a third party. For example, these technologies may collect information about whether you clicked an ad to download our application.

Back Button

### Cookie List

Search Icon

Filter Icon

Clear

checkbox labellabel

ApplyCancel

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Confirm my choices

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)